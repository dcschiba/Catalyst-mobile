<!DOCTYPE html>
<html style="width:100%; height:100%; margin:0; padding:0; font-family: 'Helvetica Neue', Helvetica, sans-serif !important; font-size: 13px;">
    <head>
        <meta charset="utf-8">
        <title>WRAP Venus TropicalStorm Sample</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ol3/3.4.0/ol.js"></script>
        <script type="text/javascript" src="3rd/js/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="js/WRAP.DH-1.2.0.0-min.js"></script>
        <script type="text/javascript" src="js/WRAP.Geo-1.2.0.0-min.js"></script>
        <script type="text/javascript" src="js/WRAP.ASM.js"></script>
    </head>
    <body style="width:100%; height:100%; margin:0; padding:0; background-color:rgb(255,255,255);">
        <div style="color:black; position:absolute; left:20px; top:8px;">TropicalStorm</div>
        <label style="position:absolute; width:160px; height:18px; left:150px; top:6px;">
            <input type="checkbox" id="track_history" checked><spawn style="position:absolute; top:2px; left:20px;">Track History</spawn>
        </label>
        <label style="position:absolute; width:160px; height:18px; left:250px; top:6px;">
            <input type="checkbox" id="forcast_track" checked><spawn style="position:absolute; top:2px; left:20px;">Forecast Track</spawn>
        </label>
        <label style="position:absolute; width:160px; height:18px; left:370px; top:6px;">
            <input type="checkbox" id="forcast_wind_radii" checked><spawn style="position:absolute; top:2px; left:20px;">Forecast Wind Radii</spawn>
        </label>
        <label style="position:absolute; width:160px; height:18px; left:520px; top:6px;">
            <input type="checkbox" id="analysis_wind_radii" checked><spawn style="position:absolute; top:2px; left:20px;">Analysis Wind Radii</spawn>
        </label>
        <a href="../doc/reference/sample_code/tropicalstorm.html" target="_blank" style="position:absolute; right:40px; top:8px;" >Document</a>

        <div id="map_canvas" style="position:absolute; top:30px; bottom:10px; left:10px; right:10px;"></div>

        <script type="text/javascript">
            // Mapの初期画角
            var initial_lat = 35.65;
            var initial_lon = 140.045;
            var initial_zoom = 4;

            var conf_path = "./pri/conf";     // ローカルの sample_data用コンフィグを用いる
            
            // Setup openLayers Maps
            var map_canvas = document.getElementById('map_canvas');
            var o_map = new ol.Map({
                layers:[ new ol.layer.Tile({
                        source: new ol.source.OSM()
                    })
                ],
                target: 'map_canvas',
                view: new ol.View({
                    center: ol.proj.transform([initial_lon, initial_lat], 'EPSG:4326', 'EPSG:3857'),
                    zoom: initial_zoom
                })
            });
            WRAP.Geo.setOpenLayers(o_map)

            // Data
            WRAP.DH.conf_path = conf_path+"/data";
            var data = WRAP.DH.addObject("WX_WNI_TropicalStorm");
            
            // Layers
            var layer = new WRAP.Geo.Layer("TropicalStorm");
            
            WRAP.Geo.setLayer({
                upper_layers : [
                    layer
                ]
            });

            // Configure Layers
            $.when(
                $.getJSON(conf_path + '/layer/TropicalStorm.json')
            ).done(function() {
                layer.configure(data, arguments[0]);
            });
            
            // Tooltip
            WRAP.Geo.setInteraction(map_canvas);
            layer.setTooltip(function(geo) {
                var p = geo && geo.properties;
                if ( p ) {
                    var valid = p.valid.substr(4,2)+"/"+p.valid.substr(6,2)+" "+p.valid.substr(9,2)+":"+p.valid.substr(11,2)
                    return "ename : "+(p.ename?p.ename:"-")+"<br>"
                         + "class : "+p.class+"<br>"
                         + "valid :"+valid;
                }
            });
        
            // チェック内容に応じて要素の表示状態をOn/Offする
            function updateContents() {
                var forcast_track = $('#forcast_track').prop('checked');
                var track_history = $('#track_history').prop('checked');
                var forcast_wind_radii = $('#forcast_wind_radii').prop('checked');
                var analysis_wind_radii = $('#analysis_wind_radii').prop('checked');
                layer.setAttributes({
                    show_forcast_track:forcast_track,
                    show_track_history:track_history,
                    show_forcast_wind_radii:forcast_wind_radii,
                    show_analysis_wind_radii:analysis_wind_radii
                });
            }

            $('input:checkbox').click(updateContents);
            updateContents();
            
        </script>
    </body>
</html>
