<!DOCTYPE html>
<html style="width:100%; height:100%; margin:0; padding:0; font-family: 'Helvetica Neue', Helvetica, sans-serif !important; font-size: 13px;">
    <head>
        <meta charset="utf-8">
        <title>WRAP Mercury Distance Caliculation Sample</title>
        <script src="https://maps.googleapis.com/maps/api/js?client=gme-weathernewsinc&libraries=geometry"></script>
        <script type="text/javascript" src="3rd/js/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="js/WRAP.DH-1.1.0.0.js"></script>
        <script type="text/javascript" src="js/WRAP.Geo-1.1.0.0.js"></script>
        
    </head>
    <body style="width:100%; height:100%; margin:0; padding:0; background-color:rgb(255,255,255);">
        <div style="color:black; position:absolute; left:20px; top:8px;">Distance Caliculation</div>
        <div id="p0" style="color:#555; position:absolute; left:180px; top:8px; color:#f00;">---</div>
        <div id="p1" style="color:#555; position:absolute; left:360px; top:8px; color:#00f;">---</div>
        <div id="ds" style="color:#555; position:absolute; left:540px; top:8px; color:#088;">Distance = </div>
        <label style="position:absolute; width:60px; height:18px; left:740px; top:6px; color:#808;">
            <input type="checkbox" id="circle" ><spawn style="position:absolute; top:2px; left:20px;">Circle</spawn>
        </label>
        <label style="position:absolute; width:60px; height:18px; left:820px; top:7px; color:#404;">radius</label>
        <input type="text" id="radius" style="position:absolute; width:50px; height:14px; left:860px; top:4px;"/>
        <label style="position:absolute; width:60px; height:18px; left:920px; top:7px; color:#404;">km</label>
        <a href="../doc/reference/sample_code/distance.html" target="_blank" style="position:absolute; right:40px; top:8px;" >Document</a>
        <div id="map_canvas" style="position:absolute; top:30px; bottom:10px; left:10px; right:10px;"></div>

        <script type="text/javascript">
            // Mapの初期画角
            var initial_lat = 35.65;
            var initial_lon = 140.045;
            var initial_zoom = 6;

            // Setup Google Maps
            var map_canvas = document.getElementById('map_canvas');
            var g_map = new google.maps.Map(map_canvas, {
                zoom: initial_zoom,
                minZoom: 3,
                maxZoom: 15,
                center: new google.maps.LatLng(initial_lat, initial_lon),
                zoomControl: true,
                mapTypeControl: false,
                scaleControl: false,
                streetViewControl: false,
                draggableCursor: "default",
                mapTypeId: google.maps.MapTypeId.ROADMAP
            });
            WRAP.Geo.setGoogleMaps(g_map);
            
            // map_canvasに対するマウス操作監視を登録 (Featureのドラッグのため)
            WRAP.Geo.setInteraction(map_canvas);

            // レイヤーの登録
            var layer = new WRAP.Geo.Layer("DistanceCaliculatorSample");
            WRAP.Geo.setLayer({
                upper_layers : [
                    layer
                ]
            });
        
            var pos_0 = [140,40];
            var pos_1 = [135,35];
            var radius = 100000;
            
            var point_0, point_1;       // 2点の Feature
            var path;                   // 2点間を結ぶ直線の Feature
            var arc;                    // 円の Feature
            
            // 各 Featureを作成
            path = new WRAP.Geo.Feature.GeoLine({   // ラインのスタイル
                path:[pos_0, pos_1],    // 座標列
                strokeStyle:'#088',     // ラインカラー
                lineWidth:3             // ライン幅
            });
            
            var circle_style = {        // 円弧のスタイル
                point:pos_0,            // 中心座標
                radius:radius,          // 半径（m）
                start:0,                // 開始角度（度）
                end:360,                // 終了角度（度）
                strokeStyle:'rgba(128,0,128,0.7)',  // ラインカラー
                fillStyle:'rgba(128,0,128,0.3)',    // フィルカラー
                lineWidth:2                         // ライン幅
            }
            arc = new WRAP.Geo.Feature.GeoArc(circle_style);

            point_0 = new WRAP.Geo.Feature.Point({  // ポイントのスタイル
                point:pos_0,            // 座標
                strokeStyle:'#FFF',     // ラインカラー
                lineWidth:2,            // ライン幅
                fillStyle:'#F00',       // フィルカラー
                pointSize:14            // ポイントサイズ
            });
            
            point_1 = new WRAP.Geo.Feature.Point({  // ポイントのスタイル
                point:pos_1,            // 座標
                strokeStyle:'#FFF',     // ラインカラー
                lineWidth:2,            // ライン幅
                fillStyle:'#00F',       // フィルカラー
                pointSize:14            // ポイントサイズ
            });
            
            // Point Featureをドラッグ可能に設定。第二引数に位置変更時のコールバックを指定する。
            point_0.setDraggable(true, function(feature, point) {
                updateDistance();
            });
            point_1.setDraggable(true, function(feature, point) {
                updateDistance();
            });
            
            // 距離測定および表示
            function updateDistance() {
                // 2点間の距離を計算
                var dist = WRAP.Geo.getDistance(new WRAP.Geo.Point(pos_0[1]*60, pos_0[0]*60),
                                                new WRAP.Geo.Point(pos_1[1]*60, pos_1[0]*60));
                // 座標と距離の表示
                $('#p0').html(pos_0[1].toFixed(6)+","+pos_0[0].toFixed(6));
                $('#p1').html(pos_1[1].toFixed(6)+","+pos_1[0].toFixed(6));
                $('#ds').html("Distance = "+dist.toFixed(2)+"m");
            }
        
            // レイヤーにディスプレイリスト（Feature配列）を登録しレンダリングさせる。
            function setDisplayList() {
                layer.clear();                  // ディスプレイリストのクリア
                layer.addFeature(path);
                if ( radius > 0 && $('#circle').prop('checked') )
                    layer.addFeature(arc);
                layer.addFeature(point_0);
                layer.addFeature(point_1);
                WRAP.Geo.invalidate();          // レンダリング
            }
        
            // 半径入力時の再描画
            $('#radius').val(radius/1000).change(function() {
                // 半径の更新
                circle_style.radius = radius = $('#radius').val()*1000;
                if ( $('#circle').prop('checked') )
                    WRAP.Geo.invalidate();
            });
            $('#circle').click(setDisplayList);

            // 初期表示
            updateDistance();
            setDisplayList();
        </script>
    </body>
</html>
